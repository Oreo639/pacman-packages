diff -NBaur flac-1.3.3-org/include/share/compat.h flac-1.3.3/include/share/compat.h
--- flac-1.3.3-org/include/share/compat.h	2018-08-18 22:15:53.303354000 -0700
+++ flac-1.3.3/include/share/compat.h	2019-08-30 16:47:14.492065603 -0700
@@ -159,8 +159,14 @@
 #define flac_vfprintf vfprintf
 
 #define flac_fopen fopen
+#ifdef _3DS
+#define flac_chmod(a, b) printf("flac_chmod: not implemented\n")
+#define flac_utime(a, b) printf("flac_utime: not implemented\n")
+#define chown(a, b, c) printf("flac_chown: not implemented\n")
+#else
 #define flac_chmod chmod
 #define flac_utime utime
+#endif
 #define flac_unlink unlink
 #define flac_rename rename
 #define flac_stat stat

diff -NBaur flac-1.3.3-org/include/share/grabbag/cuesheet.h flac-1.3.3/include/share/grabbag/cuesheet.h
--- flac-1.3.3-org/include/share/grabbag/cuesheet.h	2016-12-07 12:10:26.218454000 -0800
+++ flac-1.3.3/include/share/grabbag/cuesheet.h	2019-08-30 17:02:24.445150130 -0700
@@ -29,10 +29,10 @@
 extern "C" {
 #endif
 
-unsigned grabbag__cuesheet_msf_to_frame(unsigned minutes, unsigned seconds, unsigned frames);
-void grabbag__cuesheet_frame_to_msf(unsigned frame, unsigned *minutes, unsigned *seconds, unsigned *frames);
+uint32_t grabbag__cuesheet_msf_to_frame(uint32_t minutes, uint32_t seconds, uint32_t frames);
+void grabbag__cuesheet_frame_to_msf(uint32_t frame, uint32_t *minutes, uint32_t *seconds, uint32_t *frames);
 
-FLAC__StreamMetadata *grabbag__cuesheet_parse(FILE *file, const char **error_message, unsigned *last_line_read, unsigned sample_rate, FLAC__bool is_cdda, FLAC__uint64 lead_out_offset);
+FLAC__StreamMetadata *grabbag__cuesheet_parse(FILE *file, const char **error_message, uint32_t *last_line_read, uint32_t sample_rate, FLAC__bool is_cdda, FLAC__uint64 lead_out_offset);
 
 void grabbag__cuesheet_emit(FILE *file, const FLAC__StreamMetadata *cuesheet, const char *file_reference);
 

diff -NBaur flac-1.3.3-org/include/share/grabbag/replaygain.h flac-1.3.3/include/share/grabbag/replaygain.h
--- flac-1.3.3-org/include/share/grabbag/replaygain.h	2016-12-07 12:10:26.218454000 -0800
+++ flac-1.3.3/include/share/grabbag/replaygain.h	2019-08-30 17:05:30.069167373 -0700
@@ -34,7 +34,7 @@
 extern "C" {
 #endif
 
-extern const unsigned GRABBAG__REPLAYGAIN_MAX_TAG_SPACE_REQUIRED;
+extern const uint32_t GRABBAG__REPLAYGAIN_MAX_TAG_SPACE_REQUIRED;
 
 extern const FLAC__byte * const GRABBAG__REPLAYGAIN_TAG_REFERENCE_LOUDNESS; /* = "REPLAYGAIN_REFERENCE_LOUDNESS" */
 extern const FLAC__byte * const GRABBAG__REPLAYGAIN_TAG_TITLE_GAIN; /* = "REPLAYGAIN_TRACK_GAIN" */
@@ -42,12 +42,12 @@
 extern const FLAC__byte * const GRABBAG__REPLAYGAIN_TAG_ALBUM_GAIN; /* = "REPLAYGAIN_ALBUM_GAIN" */
 extern const FLAC__byte * const GRABBAG__REPLAYGAIN_TAG_ALBUM_PEAK; /* = "REPLAYGAIN_ALBUM_PEAK" */
 
-FLAC__bool grabbag__replaygain_is_valid_sample_frequency(unsigned sample_frequency);
+FLAC__bool grabbag__replaygain_is_valid_sample_frequency(uint32_t sample_frequency);
 
-FLAC__bool grabbag__replaygain_init(unsigned sample_frequency);
+FLAC__bool grabbag__replaygain_init(uint32_t sample_frequency);
 
 /* 'bps' must be valid for FLAC, i.e. >=4 and <= 32 */
-FLAC__bool grabbag__replaygain_analyze(const FLAC__int32 * const input[], FLAC__bool is_stereo, unsigned bps, unsigned samples);
+FLAC__bool grabbag__replaygain_analyze(const FLAC__int32 * const input[], FLAC__bool is_stereo, uint32_t bps, uint32_t samples);
 
 void grabbag__replaygain_get_album(float *gain, float *peak);
 void grabbag__replaygain_get_title(float *gain, float *peak);
diff -NBaur flac-1.3.3-org/include/share/grabbag/seektable.h flac-1.3.3/include/share/grabbag/seektable.h

--- flac-1.3.3-org/include/share/grabbag/seektable.h	2016-12-07 12:10:26.218454000 -0800
+++ flac-1.3.3/include/share/grabbag/seektable.h	2019-08-30 17:06:35.404173442 -0700
@@ -30,7 +30,7 @@
 extern "C" {
 #endif
 
-FLAC__bool grabbag__seektable_convert_specification_to_template(const char *spec, FLAC__bool only_explicit_placeholders, FLAC__uint64 total_samples_to_encode, unsigned sample_rate, FLAC__StreamMetadata *seektable_template, FLAC__bool *spec_has_real_points);
+FLAC__bool grabbag__seektable_convert_specification_to_template(const char *spec, FLAC__bool only_explicit_placeholders, FLAC__uint64 total_samples_to_encode, uint32_t sample_rate, FLAC__StreamMetadata *seektable_template, FLAC__bool *spec_has_real_points);
 
 #ifdef __cplusplus
 }

diff -NBaur flac-1.3.3-org/include/share/replaygain_synthesis.h flac-1.3.3/include/share/replaygain_synthesis.h
--- flac-1.3.3-org/include/share/replaygain_synthesis.h	2016-12-07 12:10:26.218454000 -0800
+++ flac-1.3.3/include/share/replaygain_synthesis.h	2019-08-30 17:43:36.159379732 -0700
@@ -47,6 +47,6 @@
 void FLAC__replaygain_synthesis__init_dither_context(DitherContext *dither, int bits, int shapingtype);
 
 /* scale = (float) pow(10., (double)replaygain * 0.05); */
-size_t FLAC__replaygain_synthesis__apply_gain(FLAC__byte *data_out, FLAC__bool little_endian_data_out, FLAC__bool unsigned_data_out, const FLAC__int32 * const input[], unsigned wide_samples, unsigned channels, const unsigned source_bps, const unsigned target_bps, const double scale, const FLAC__bool hard_limit, FLAC__bool do_dithering, DitherContext *dither_context);
+size_t FLAC__replaygain_synthesis__apply_gain(FLAC__byte *data_out, FLAC__bool little_endian_data_out, FLAC__bool unsigned_data_out, const FLAC__int32 * const input[], uint32_t wide_samples, uint32_t channels, const uint32_t source_bps, const uint32_t target_bps, const double scale, const FLAC__bool hard_limit, FLAC__bool do_dithering, DitherContext *dither_context);
 
 #endif

diff -NBaur flac-1.3.3-org/Makefile.in flac-1.3.3/Makefile.in
--- flac-1.3.3-org/Makefile.in	2019-08-04 01:27:23.257543000 -0700
+++ flac-1.3.3/Makefile.in	2019-08-30 16:44:44.723051691 -0700
@@ -201,8 +201,7 @@
 ETAGS = etags
 CTAGS = ctags
 CSCOPE = cscope
-DIST_SUBDIRS = doc include m4 man src test build objs microbench \
-	examples
+DIST_SUBDIRS = include m4 src build objs
 am__DIST_COMMON = $(srcdir)/Makefile.in $(srcdir)/config.h.in AUTHORS \
 	README ar-lib compile config.guess config.rpath config.sub \
 	depcomp install-sh ltmain.sh missing
@@ -402,7 +401,7 @@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
 ACLOCAL_AMFLAGS = -I m4
-SUBDIRS = doc include m4 man src test build objs microbench \
+SUBDIRS = include m4 src build objs \
 	$(am__append_1)
 EXTRA_DIST = \
 	COPYING.FDL \

diff -NBaur flac-1.3.3-org/src/Makefile.in flac-1.3.3/src/Makefile.in
--- flac-1.3.3-org/src/Makefile.in	2019-08-04 01:27:23.753553000 -0700
+++ flac-1.3.3/src/Makefile.in	2019-08-30 16:38:40.766017882 -0700
@@ -182,9 +182,7 @@
   done | $(am__uniquify_input)`
 ETAGS = etags
 CTAGS = ctags
-DIST_SUBDIRS = libFLAC share flac metaflac plugin_common plugin_xmms \
-	test_grabbag test_libs_common test_libFLAC test_seeking \
-	test_streams utils libFLAC++ test_libFLAC++
+DIST_SUBDIRS = libFLAC share plugin_common plugin_xmms libFLAC++ test_libFLAC++
 am__DIST_COMMON = $(srcdir)/Makefile.in
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 am__relativize = \
@@ -370,15 +368,7 @@
 SUBDIRS = \
 	libFLAC \
 	share \
-	flac \
-	metaflac \
 	$(XMMS_DIRS) \
-	test_grabbag \
-	test_libs_common \
-	test_libFLAC \
-	test_seeking \
-	test_streams \
-	utils \
 	$(CPPLIBS_DIRS)
 
 EXTRA_DIST = \

